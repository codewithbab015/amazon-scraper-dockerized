---
version: '3'

tasks:
  run:
    desc: Run ETL locally and save cleaned data to the local data folder
    vars:
      RUN_GROUP: '{{.RUN_GROUP | default "electronics"}}'
      RUN_NAME: '{{.RUN_NAME | default "camera-photo"}}'
      RUN_MODE: '{{.RUN_MODE | default "extract"}}'
      MAX: '{{.MAX | default ""}}'
      DESTINATION: '{{.DESTINATION | default ""}}'
    preconditions:
      - sh: |
          echo "{{.RUN_MODE}}"

          if [ "{{.RUN_MODE}}" = "extract" ]; then
            if [ -z "{{.MAX}}" ]; then
              echo "Error: --max must be set when RUN_MODE is 'extract'"
              exit 1
            fi
          elif [ "{{.RUN_MODE}}" = "load" ]; then
            if [ -z "{{.DESTINATION}}" ]; then
              echo "Error: --destin must be set when RUN_MODE is 'load'"
              exit 1
            fi
          fi
    cmds:
      - python run_script.py --run_group {{.RUN_GROUP}} --run_name {{.RUN_NAME}} --run_mode {{.RUN_MODE}} {{if eq .RUN_MODE "extract"}}--max {{.MAX}}{{end}} {{if eq .RUN_MODE "load"}}--destin {{.DESTINATION}}{{end}}